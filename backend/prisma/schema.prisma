// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 供货商
model Supplier {
  id          String   @id @default(uuid()) // 主键ID（UUID）
  name        String // 供货商名称（必填）
  phone       String? // 联系电话（可选）
  wechat      String? // 微信账号（可选）
  description String? // 供货商描述（可选）
  rating      String? // 供货商评价（可选）
  images      String // 供货商图片数组，以JSON字符串存储
  delete      Int      @default(0)
  createdAt   DateTime @default(now()) // 创建时间
  updatedAt   DateTime @updatedAt // 最后更新时间

  @@index([name])
}

// 商品类型
model ProductType {
  id          String    @id @default(uuid()) // 主键ID（UUID）
  name        String // 分类名称（必填）
  description String? // 分类描述（可选）
  Product     Product[]
  delete      Int       @default(0)
  createdAt   DateTime  @default(now()) // 创建时间
  updatedAt   DateTime  @updatedAt // 最后更新时间
}

// 商品
model Product {
  id            String      @id @default(uuid()) // 主键ID（UUID）
  name          String // 商品名称（必填）
  description   String? // 商品描述（可选）
  productType   ProductType @relation(fields: [productTypeId], references: [id])
  productTypeId String
  delete        Int         @default(0)
  createdAt     DateTime    @default(now()) // 创建时间
  updatedAt     DateTime    @updatedAt // 最后更新时间

  @@index([name])
}

// 客户
model Customer {
  id          String   @id @default(uuid()) // 主键ID（UUID）
  name        String // 客户姓名（必填）
  phone       Int? // 联系电话（可选）
  wechat      String? // 微信账号（可选）
  address     String? // 地址信息（可选）
  description String? // 客户描述（可选）
  orders      Order[]
  delete      Int      @default(0)
  createdAt   DateTime @default(now()) // 创建时间
  updatedAt   DateTime @updatedAt // 最后更新时间

  @@index([name])
}

// 团购单
model GroupBuy {
  id          String            @id @default(uuid()) // 主键ID（UUID）
  name        String // 团购名称（必填）
  description String? // 团购描述（可选）
  variants    GroupBuyVariant[] // 关联的规格
  Order       Order[]
  images      String // 商品图片数组，以JSON字符串存储
  delete      Int               @default(0)
  createdAt   DateTime          @default(now()) // 创建时间
  updatedAt   DateTime          @updatedAt // 最后更新时间

  @@index([name])
}

// 团购规格
model GroupBuyVariant {
  id         String   @id @default(uuid()) // 主键ID（UUID）
  name       String // 规格名称（如"1袋"、"2袋"）
  price      Decimal // 售价（必填）
  costPrice  Decimal // 成本价（必填）
  groupBuyId String
  groupBuy   GroupBuy @relation(fields: [groupBuyId], references: [id])
  Order      Order[]
  delete     Int      @default(0)
  createdAt  DateTime @default(now()) // 创建时间
  updatedAt  DateTime @updatedAt // 最后更新时间

  @@index([name])
  @@index([groupBuyId])
}

enum OrderStatus {
  COMPLETED // 已完成
  REFUNDED // 已退款
}

// 订单
model Order {
  id                String          @id @default(uuid())
  customerId        String
  customer          Customer        @relation(fields: [customerId], references: [id])
  status            OrderStatus // 订单状态（是否退款）
  groupBuyId        String?
  groupBuy          GroupBuy?       @relation(fields: [groupBuyId], references: [id])
  groupBuyVariantId String
  groupBuyVariant   GroupBuyVariant @relation(fields: [groupBuyVariantId], references: [id])
  quantity          Int // 购买数量（如购买2个"5元2袋"规格）
  delete            Int             @default(0)
  createdAt         DateTime        @default(now()) // 创建时间
  updatedAt         DateTime        @updatedAt // 最后更新时间

  @@index([customerId])
  @@index([groupBuyId])
  @@index([groupBuyVariantId])
}
